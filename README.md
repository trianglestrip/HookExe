# 进程窗口OCR截图工具 - 模块化版本

> 📄 **注意**: 代码已重构为模块化架构，提供更好的可维护性和功能分离

## 🚀 快速启动

```bash
# 推荐：使用新的模块化版本
python main.py

# 或者：使用兼容性入口（会提示升级）
python process_capture.py
```

## 📁 模块化架构

新版本采用模块化设计，将功能分离到不同文件中：

| 模块文件 | 功能描述 | 主要职责 |
|---------|---------|----------|
| `main.py` | 主程序入口 | 应用程序控制器，整合所有模块 |
| `process_capture_ui.py` | GUI界面模块 | 所有tkinter界面逻辑和用户交互 |
| `process_manager.py` | 进程管理模块 | 进程查找、窗口管理、系统API调用 |
| `screenshot_engine.py` | 截图引擎模块 | 多种截图方法、黑色图像检测 |
| `ui_logger.py` | 日志系统模块 | 日志输出、时间记录、性能监控 |
| `ocr_engine.py` | OCR识别引擎 | 文字识别、结果处理、置信度筛选 |
| `process_capture.py` | 兼容性入口 | 向后兼容，引导用户使用新版本 |

## 功能简介

这是一个智能的进程窗口截图和OCR识别工具，支持以下功能：

- 🔍 **智能搜索**: 根据进程名关键字搜索匹配的进程
- 📸 **多种截图方式**: 标准截图、窗口句柄、自动选择
- 🤖 **OCR文字识别**: 自动识别截图中的文字内容
- 🎨 **可视化标记**: 在图片上绘制文字框和置信度信息
- ⏰ **自动截图**: 支持定时自动截图功能
- 📊 **性能监控**: 详细的时间记录和日志输出
- 📂 **智能命名**: 根据OCR结果自动命名保存文件

## 依赖库要求

### 快速安装
```bash
# 使用requirements.txt安装（推荐）
pip install -r requirements.txt

# 或者手动安装
pip install keyboard pillow paddleocr opencv-python psutil pywin32 numpy
```

### 核心依赖库
- **tkinter** - GUI界面框架（Python内置）
- **Pillow** - 图像处理和截图
- **PaddleOCR** - OCR文字识别引擎
- **OpenCV** - 计算机视觉处理
- **NumPy** - 数值计算和数组处理
- **psutil** - 进程管理和监控
- **pywin32** - Windows API调用（仅Windows）
- **keyboard** - 全局键盘监听

### 依赖验证
运行依赖检查脚本：
```bash
python check_dependencies.py
```

详细安装指南请查看 [INSTALL.md](INSTALL.md) 文件。

## 快速启动

### Windows
```bash
# 双击启动脚本
start_process_capture.bat

# 或者直接运行
python process_capture.py
```

### Linux/macOS
```bash
# 添加执行权限
chmod +x start_process_capture.sh

# 运行启动脚本
./start_process_capture.sh

# 或者直接运行
python3 process_capture.py
```

## 使用方法

### 1. 搜索进程
1. 在"进程名关键字"输入框中输入要搜索的进程名部分字符串
2. 按回车键或点击"搜索进程"按钮
3. 程序会显示所有匹配的进程和对应的窗口

### 2. 选择进程
- 搜索完成后会自动选中第一个进程
- 可以手动点击选择其他进程

### 3. 设置保存路径
- 可以在"保存路径"中设置截图保存的文件夹
- 点击"浏览"按钮选择文件夹
- 默认保存到 `./screenshots` 文件夹

### 4. 截图和OCR识别

#### 单次截图OCR
- 选择进程后，点击"截图OCR识别"按钮
- 或者双击进程列表中的进程

#### 自动定时截图OCR
1. 勾选"自动定时截图"选项
2. 设置截图间隔时间（秒）
3. 点击"开始自动OCR"
4. 需要停止时点击"停止截图"

### 5. 截图方法选择
- **标准截图（默认）**: 使用系统标准截图API，速度快
- **自动选择**: 智能尝试多种截图方式，自动处理黑屏问题
- **窗口句柄**: 直接通过窗口句柄获取内容，适合游戏等应用

### 6. 时间记录功能
- 勾选"启用时间记录"查看详细的性能统计
- 在日志区域可以看到每个阶段的耗时分析
- 支持导出日志进行性能分析

## 特色功能

### 🎯 智能进程识别
- 支持按进程名搜索
- 支持按窗口标题搜索
- 实时显示进程PID、名称和窗口标题

### 📋 OCR结果可视化
- **红色边框**: 标记识别的文字区域
- **红色标签**: 显示置信度数值
- **蓝色标签**: 显示识别的文字内容（短文字）
- 只显示置信度>0.8的高质量识别结果

### 📂 智能文件命名
截图文件自动按以下格式命名：
```
进程名_PID_时间戳_OCR_N个文字.png
例如：notepad.exe_1234_20231201_143052_OCR_3个文字.png

无OCR结果时：
进程名_PID_时间戳_无OCR.png
```

### ⚡ 性能监控
详细记录各阶段耗时：
- 窗口激活: 0.022秒
- 截图阶段: 0.053秒  
- OCR识别: 1.588秒
- 绘制标记: 0.034秒
- 文件保存: 0.033秒
- 总耗时: 1.733秒

### 📊 日志系统
- 实时日志输出，支持滚动查看
- 精确到毫秒的时间戳
- 支持清空日志和导出日志功能
- 不同级别的日志消息（INFO、ERROR）

## 🔧 解决截图黑色问题

### 问题原因
截图显示为黑色通常由以下原因造成：
1. **窗口未激活**: 目标窗口在后台或最小化状态
2. **渲染保护**: 某些应用程序（如游戏、视频播放器）有硬件加速保护
3. **权限不足**: 系统级应用需要管理员权限
4. **窗口遮挡**: 目标窗口被其他窗口覆盖

### 解决方案

#### 🎯 截图方法选择
程序提供三种截图方法：

1. **标准截图（默认）**
   - 使用系统标准截图API
   - 速度快，兼容性好
   - 对于某些应用可能显示黑色

2. **自动选择**
   - 程序会自动尝试多种截图方式
   - 检测黑色图像并切换到其他方法
   - 适合大多数应用程序

3. **窗口句柄**
   - 直接通过窗口句柄获取内容
   - 可以绕过某些渲染保护
   - 对游戏和视频应用效果较好

#### ⚡ 窗口激活功能
程序会自动：
- 恢复最小化的窗口
- 将目标窗口置于前台
- 强制激活窗口（如果需要）
- 等待窗口完全激活后再截图

#### 🛠️ 使用建议
1. **首次使用**: 选择"标准截图"方法
2. **仍然黑色**: 尝试"窗口句柄"方法
3. **系统应用**: 以管理员身份运行程序
4. **游戏应用**: 确保游戏窗口化运行
5. **视频播放**: 暂停播放或关闭硬件加速

## 系统要求

- **操作系统**: Windows 10+、Ubuntu 18.04+、macOS 10.14+
- **Python版本**: Python 3.7 或以上
- **内存要求**: 建议 4GB 以上（OCR模型较大）
- **磁盘空间**: 2GB 以上（用于OCR模型）

## 使用场景

- 📊 **软件测试**: 定时截图记录软件运行状态
- 📝 **过程记录**: 记录操作过程和界面变化
- 🔍 **问题调试**: 捕获软件异常状态和文字信息
- 📈 **性能监控**: 监控特定程序的界面状态
- 🤖 **自动化测试**: 验证界面文字是否正确显示
- 📋 **内容审核**: 快速识别和标记界面文字

## 故障排除

### 常见问题

1. **找不到进程**
   - 检查进程是否正在运行
   - 尝试使用更精确的关键字
   - 确认进程有可见窗口

2. **截图失败**
   - 检查窗口是否最小化
   - 确认有足够的磁盘空间
   - 验证保存路径的写入权限
   - 尝试不同的截图方法

3. **OCR识别失败**
   - 检查网络连接（首次使用需要下载模型）
   - 确认图片质量和清晰度
   - 检查是否有中文字符显示

4. **程序无响应**
   - 关闭程序重新启动
   - 检查是否有其他程序占用资源
   - 查看日志区域的错误信息

## 更新日志

### v1.0.0
- ✨ 基础进程搜索和截图功能
- 🔍 集成PaddleOCR文字识别
- 🎨 OCR结果可视化标记
- ⏰ 自动定时截图功能
- 📊 详细的时间记录和日志系统
- 🛠️ 多种截图方法和黑屏问题解决
- 📁 智能文件命名和保存管理

## 技术架构

- **GUI框架**: Tkinter（Python内置）
- **进程管理**: psutil + Windows API
- **图像处理**: Pillow + OpenCV
- **OCR引擎**: PaddleOCR
- **截图技术**: PIL ImageGrab + Windows GDI
- **多线程**: threading（自动截图功能）

## 许可证

本项目采用 MIT 许可证，详情请查看 LICENSE 文件。

## 联系方式

如有问题或建议，请提交 Issue 或联系开发者。

---

希望这个工具能帮助您高效地完成进程窗口截图和OCR识别任务！ 🚀