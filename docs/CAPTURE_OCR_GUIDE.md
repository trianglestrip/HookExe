# Capture.py OCR结果保存功能说明

## 🎯 新增功能概述

现在[capture.py](file://d:\project\pojie\ocr\capture.py)已经支持与[main.py](file://d:\project\pojie\ocr\main.py)相同的OCR识别结果绘制和保存功能！

## ✨ 主要改进

### 1. **OCR结果可视化**
- ✅ **红色边框**: 标记识别的文字区域
- ✅ **红色标签**: 显示置信度数值（格式：0.xxx）
- ✅ **蓝色标签**: 显示识别的文字内容（限20字符内）
- ✅ **字体支持**: 自动尝试加载中文字体，失败时降级到默认字体

### 2. **智能文件命名**
截图文件自动按以下格式命名：
```
capture_时间戳_OCR_N个文字.png
例如：capture_20240904_143052_OCR_3个文字.png

无OCR结果时：
capture_时间戳_无OCR.png
例如：capture_20240904_143052_无OCR.png
```

### 3. **自动保存功能**
- 📁 **保存路径**: `./screenshots/` 目录
- 💾 **自动创建**: 如果目录不存在会自动创建
- 🔄 **错误处理**: 即使OCR失败也会保存原始截图

## 🚀 使用方法

### 启动程序
```bash
python capture.py
```

### 热键操作
1. **`g` 键**: 区域选择截图
   - 拖拽选择任意区域
   - 自动进行OCR识别
   - 绘制红框标记并保存

2. **`Shift+g` 键**: 默认大小截图
   - 屏幕中心600x600像素截图
   - 自动进行OCR识别
   - 绘制红框标记并保存

3. **`Ctrl+C` 键**: 退出程序

## 📊 功能对比

| 功能 | capture.py | main.py |
|------|-----------|---------|
| OCR识别 | ✅ | ✅ |
| 红框标记 | ✅ | ✅ |
| 置信度显示 | ✅ | ✅ |
| 文字标签 | ✅ | ✅ |
| 智能命名 | ✅ | ✅ |
| 自动保存 | ✅ | ✅ |
| 热键触发 | ✅ | ❌ |
| GUI界面 | ❌ | ✅ |
| 进程选择 | ❌ | ✅ |

## 💡 输出示例

### 成功识别时的输出
```
截图完成，尺寸: (300, 200, 3)
正在进行OCR识别...

找到 2 个高置信度结果
开始绘制 2 个高置信度文字框
文字框绘制完成
截图完成，已保存到: ./screenshots/capture_20240904_143052_OCR_2个文字.png
OCR结果: 2 个高置信度文字

=== OCR识别结果 ===

1. 文本: Hello World, 置信度: 0.963
2. 文本: 测试文字, 置信度: 0.887
==============================
```

### 无识别结果时的输出
```
截图完成，尺寸: (300, 200, 3)
正在进行OCR识别...
没有找到置信度大于0.7的识别结果
截图完成，已保存到: ./screenshots/capture_20240904_143052_无OCR.png
OCR结果: 0 个高置信度文字
```

## 🛠 技术实现

### 核心方法
1. **`draw_ocr_results()`**: 绘制OCR识别结果
   - 红色边框绘制
   - 置信度标签绘制  
   - 文字内容标签绘制
   - 字体加载和降级处理

2. **`save_screenshot_with_ocr()`**: 保存截图
   - 智能文件命名
   - 目录自动创建
   - OCR结果详细输出
   - 错误处理机制

3. **`recognize_text()`**: OCR识别（增强版）
   - 支持传入原始PIL图像
   - 自动调用绘制和保存功能
   - 完整的错误处理

## 🎉 总结

现在`capture.py`已经具备了完整的OCR识别、结果可视化和自动保存功能，与`main.py`的功能保持一致。您可以：

- ✅ 使用热键快速截图并OCR识别
- ✅ 自动保存带有红框标记的结果图片
- ✅ 查看详细的OCR识别结果输出
- ✅ 享受与主程序相同的识别精度和视觉效果

立即尝试：运行 `python capture.py`，然后按 `g` 键开始截图！